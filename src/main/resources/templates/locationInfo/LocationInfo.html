<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ìì „ê±° ëŒ€ì—¬ì†Œ ì •ë³´</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
      var pop;

      function goPopup() {
          pop = window.open("public-bicycle/jusoPopup", "pop", "width=570, height=420, scrollbars=yes");
      }
      function jusoCallBack(roadFullAddr, roadAddrPart1) {
          var form = $('<form></form>');
          form.attr('action', '/public-bicycle');
          form.attr('method', 'post');
          form.appendTo('body');
          form.append($('<input type="hidden" value="' + roadFullAddr + '" name=roadFullAddr>'));
          form.append($('<input type="hidden" value="' + roadAddrPart1 + '" name=roadAddrPart1>'));
          form.submit();
          pop.close();
      }
  </script>
</head>
<body>
<button onclick="goPopup();">ë„ë¡œëª…ì£¼ì†Œ í˜¸ì¶œí•´ë³´ê¸°</button>
<!-- ì£¼ì†Œ í¼ ë°ì´í„° ì…ë ¥-->
<form id="searchForm">
  <select name="sido" id="sido-select" onchange="updateSigunguDropdown()">
    <option value="">ì‹œë„ ì„ íƒ</option>
    <option th:each="sido : ${sidoList}" th:value="${sido}" th:text="${sido}"></option>
  </select>
  <select name="sigungu" id="sigungu-select" onchange="updateEupMyunDongDropdown()">
    <option value="">ì‹œêµ°êµ¬ ì„ íƒ</option>
  </select>
  <select name="eupmyundong" id="eupmyundong-select">
    <option value="">ìë©´ë™ ì„ íƒ</option>
  </select>
  <button type="submit">ê²€ìƒ‰</button>
</form>

<!--í¼ ë°ì´í„° ì œì¶œ í›„ ì •ë³´ ì¶œë ¥-->
<div id="resultDiv">
  <h1>ìì „ê±° ëŒ€ì—¬ì†Œ ì •ë³´</h1>
  <div>
    <ul id="results1"></ul>
  </div>

  <h1>ëŒ€ì—¬ ê°€ëŠ¥ ìì „ê±° ì •ë³´</h1>
  <div>
    <ul id="results2"></ul>
  </div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œë„ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    $(document).ready(function () {
        initializeSidoSelect();
    });


    // ì´ˆê¸° ì‹œë„ ì„ íƒ
    function initializeSidoSelect() {
        var sidoSelect = $('#sido-select');
        var priorityCities = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'];

        var options = sidoSelect.find('option').get().map(function (option) {
            return {
                text: $(option).text(),
                value: $(option).val(),
                priority: priorityCities.includes($(option).text()) ? 0 : 1
            };
        });

        sidoSelect.empty(); // ê¸°ì¡´ ì˜µì…˜ ì œê±°
        sidoSelect.append($('<option>', {value: '', text: 'ì‹œë„ ì„ íƒ'})); // ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€

        // 1. ìš°ì„ ìˆœìœ„ ì§€ì—­ ì•ˆë‚´
        sidoSelect.append($('<option>', {
            value: '',
            text: 'ğŸ”µì„œë¹„ìŠ¤ ê°€ëŠ¥ ì§€ì—­ğŸ”µ',
            disabled: 'disabled'
        }));

        // 2. ìš°ì„ ìˆœìœ„ ì§€ì—­ ì¶”ê°€
        options.forEach(function (option) {
            if (option.priority === 0) {
                sidoSelect.append($('<option>', {value: option.value, text: option.text}));
            }
        });

        // 3. ìš°ì„ ìˆœìœ„ ì§€ì—­ ë‹¤ìŒì— êµ¬ë¶„ì„  ì¶”ê°€
        sidoSelect.append($('<option>', {
            value: '',
            text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
            disabled: 'disabled'
        }));

        // 4. ê·¸ ì™¸ ì§€ì—­ ì•ˆë‚´
        sidoSelect.append($('<option>', {
            value: '',
            text: 'ğŸ”ºì„œë¹„ìŠ¤ ì¤€ë¹„ ì§€ì—­ğŸ”º',
            disabled: 'disabled'
        }));

        // 5. ê·¸ ì™¸ ì§€ì—­ ë¦¬ìŠ¤íŠ¸
        options.forEach(function (option) {
            sidoSelect.append($('<option>', {value: option.value, text: option.text}));
        });
    }

    // ì‹œêµ°êµ¬ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateSigunguDropdown() {
        var selectedSido = $('#sido-select').val();
        $.ajax({
            // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë§Œë“¤ì–´ì¤Œ
            url: '/public-bicycle/sigungu',
            type: 'GET',
            data: {sido: selectedSido},
            // ì„±ê³µ ì‹œ ì•„ë˜ ë‚´ìš© ìˆ˜í–‰
            success: function (data) {
                var sigunguSelect = $('#sigungu-select');
                sigunguSelect.empty();
                sigunguSelect.append($('<option>', {
                    value: '',
                    text: 'ì‹œêµ°êµ¬ ì„ íƒ'
                }));
                $.each(data, function (index, value) {
                    sigunguSelect.append($('<option>', {
                        value: value,
                        text: value
                    }));
                });
                // ìë©´ë™ ì„ íƒì„ ì´ˆê¸°í™”
                $('#eupmyundong-select').empty().append($('<option>', {
                    value: '',
                    text: 'ìë©´ë™ ì„ íƒ'
                }));
            }
        });
    }

    // ìë©´ë™ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateEupMyunDongDropdown() {
        var selectedSigungu = $('#sigungu-select').val();
        $.ajax({
            url: '/public-bicycle/eupmyundong',
            type: 'GET',
            data: {sigungu: selectedSigungu},
            success: function (data) {
                var eupmyundongSelect = $('#eupmyundong-select');
                eupmyundongSelect.empty();
                eupmyundongSelect.append($('<option>', {
                    value: '',
                    text: 'ìë©´ë™ ì„ íƒ'
                }));
                $.each(data, function (index, value) {
                    eupmyundongSelect.append($('<option>', {
                        value: value,
                        text: value
                    }));
                });
            }
        });
    }

    // í¼ ì œì¶œ ì²˜ë¦¬
    $('#searchForm').on('submit', function (e) {
        e.preventDefault();

        var formData = $(this).serialize();

        $.ajax({
            url: '/public-bicycle',
            type: 'POST',
            data: formData,
            dataType: 'json', // JSON í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë°›ìŒ
            success: function (response) {
                // results1ê³¼ results2ë¥¼ í˜ì´ì§€ì— í‘œì‹œ
                var results1Html = response.results1.map(item => '<li>' + item + '</li>').join('');
                var results2Html = response.results2.map(item => '<li>' + item + '</li>').join('');
                $('#results1').html(results1Html);
                $('#results2').html(results2Html);
            },
            error: function (xhr, status, error) {
                console.error("Error: " + error);
            }
        });
    });
</script>
</body>
</html>