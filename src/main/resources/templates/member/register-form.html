<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <th:block th:replace="~{common/header :: headerFragment}"></th:block>
  <!--ğŸ‘‡ì—¬ê¸°ì— ê¸°íƒ€ header ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
  <style>
    .date_item{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      .warning{
        color:red;
        font-size:0.8rem;
        visibility:hidden;
        &.on{
          visibility:visible;
        }
      }
    }
  </style>
  <!--ğŸ‘† ì—¬ê¸°ì— ê¸°íƒ€ header ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ ğŸ‘†-->
</head>

<body>
<div class="wrapper">
  <th:block th:replace="~{common/sidebar :: sidebarFragment}"></th:block>

  <div class="main">
    <th:block th:replace="~{common/navbar :: navbarFragment}"></th:block>
    <main>
      <div class="container mt-4">
        <!--ğŸ‘‡ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
        <section class="py-5">
          <div class="container px-5">
            <!-- login form-->
            <div class="bg-light rounded-3 py-5 px-4 px-md-5 mb-5">
              <div class="row gx-5 justify-content-center">
                <div class="col-lg-8 col-xl-6">
                  <h1 class="text-center mb-5">íšŒì›ê°€ì…</h1>
                  <form id="registerForm" onsubmit="return false">
                    <div class="form-floating mb-3">
                      <input class="form-control" id="userId" name="userId" type="text" onkeyup="idValidCk()" maxlength="20" required placeholder="ì•„ì´ë”” ì…ë ¥">
                      <button class="btn btn-info" id="duplicateCkForId" onclick="duplicateCkForIdFnc()">ì•„ì´ë”” ì¤‘ë³µí™•ì¸</button>
                      <span id="idCkMsg"></span>
                      <label for="userId">ì•„ì´ë””</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="userName" name="userName" type="text" maxlength="30" onkeyup="userNameValidCk()" required placeholder="ì´ë¦„ ì…ë ¥">
                      <span id="userNameMsg">í•œê¸€ 2~10ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!</span>
                      <label for="userName">ì´ë¦„</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="password" name="password" type="password" onkeyup="passwordValidCkFnc()" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                      <label for="password">íŒ¨ìŠ¤ì›Œë“œ</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="passwordCk" name="passwordCk" type="password" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                      <button class="btn btn-info" id="passwordMatchCk" onclick="passwordMatchCkFnc()">íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸</button>
                      <span id="passwordCkMsg"></span>
                      <label for="passwordCk">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="email" name="email" type="text" onkeyup="emailValidCk()" maxlength="30" required placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                      <button class="btn btn-info" id="duplicateCkForEmail" onclick="duplicateCkForEmailFnc()">ì´ë©”ì¼ ì¤‘ë³µí™•ì¸</button>
                      <span id="emailCkMsg"></span>
                      <label for="email">ì´ë©”ì¼</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="nickName" name="nickName" type="text" onkeyup="nickNameValidFunc()" maxlength="30" required placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                      <button class="btn btn-info" id="duplicateCkForNickname" onclick="duplicateCkForNicknameFnc()">ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸</button>
                      <span id="nickNameCkMsg"></span>
                      <label for="nickName">ë‹‰ë„¤ì„</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="phoneNumber" name="phoneNumber" type="text" onkeyup="phoneNumberVaildFnc()" maxlength="11" required placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                      <span id="phoneNumberMsg"></span>
                      <label for="phoneNumber">ì „í™”ë²ˆí˜¸</label>
                    </div>
                    <div class="form-floating mb-3 date_item">
                      <input class="form-control" id="birthday" name="birthday" maxlength="8" required onkeyup="birthdayVaildFnc()"/>
                      <span id="birthdayMsg"></span>
                      <label for="birthday">ìƒë…„ì›”ì¼</label>
                    </div>
                    <div class="d-grid"><button class="btn btn-primary btn-lg" id="submitBtn" type="button">Submit</button></div>
                    <div style="margin-top: 16px; text-align: right"><a href="/safe-ride/login">ë¡œê·¸ì¸</a></div>
                  </form>
                </div>
              </div>

            </div>
          </div>
        </section>
        <!--ğŸ‘†ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
      </div>
    </main>
    <th:block th:replace="~{common/footer :: footerFragment}"></th:block>
  </div>
</div>

<!--ğŸ‘‡ì—¬ê¸°ì— ì‚¬ìš©í•˜ëŠ” script ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
<!--ajax-->
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script th:inline="javascript">
  window.onload = function () {
    //alert
    const alertMsg = [[${msg}]];

    if (alertMsg){
      alert(alertMsg);
    }
  }

  //í¼ ì œì¶œ
//  $(document).ready(function() {

  //ì•„ì´ë”” ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let idCk = false;
  //ì•„ì´ë”” ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
  let idDuplicateCk = false;
  //íŒ¨ìŠ¤ì›Œë“œ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let passwordCk = false;
  //íŒ¨ìŠ¤ì›Œë“œ ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
  let passwordMatchCk = false;
  //ë‹‰ë„¤ì„ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let nicknameCk = false;
  //ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ìš© flag ë³€ìˆ˜
  let nicknameDuplicateCk = false;
  //ì´ë©”ì¼ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let emailCk = false;
  //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ìš© flag ë³€ìˆ˜
  let emailDuplicateCk = false;
  //ì´ë¦„ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let userNameCk = false;
  //ìƒë…„ì›”ì¼ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let birthdayCk = false;
  //ì „í™”ë²ˆí˜¸ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
  let phoneNumberCk = false;

  //ì•„ì´ë”” ì¤‘ë³µí™•ì¸
    function duplicateCkForIdFnc(){
      let userId = $('#userId').val(); // idê°’
      if(userId.trim()===''){
        alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      } else {
        $.ajax({
          type : "POST",
          url : "/safe-ride/duplicateCkForId",
          data : {
            userId : userId
          },
          success : function (result){
            if (result===1){ // idê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
              alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.");
              idDuplicateCk = false;
            } else if(result===0) {
              alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
              idDuplicateCk = true;
            } else {
              alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
            }
          },
          error:function (error){
            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
          }
        });
      }
    }

    //ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸
    function duplicateCkForNicknameFnc(){
      let nickName = $('#nickName').val();
      if(nickName.trim()===''){
        alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      } else {
        $.ajax({
          type : "POST",
          url : "/safe-ride/duplicateCkForNickname",
          data : {
            nickName : nickName
          },
          success : function (result){
            if (result===1){ // ë‹‰ë„¤ì„ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
              alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
              nicknameDuplicateCk = false;
            } else if(result===0) {
              alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
              nicknameDuplicateCk = true;
            } else {
              alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
            }
          },
          error:function (error){
            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
          }
        });
      }
    }

    //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸
    function duplicateCkForEmailFnc(){

      let email = $('#email').val();
      if(email.trim()===''){
        alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      } else {
        $.ajax({
          type : "POST",
          url : "/safe-ride/duplicateCkForEmail",
          data : {
            email : email
          },
          success : function (result){
            if (result===1){ // ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
              alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
              emailDuplicateCk = false;
            } else if(result===0) {
              alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
              emailDuplicateCk = true;
            } else {
              alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
            }
          },
          error:function (error){
            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
          }
        });
      }
    }

    //íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    $('#submitBtn').click(function (event){
      //ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€
      event.preventDefault();
      const userIdVal = $('#userId').val();
      const userNameVal = $('#userName').val();
      const passwordVal = $('#password').val();
      const passwordCkVal = $('#passwordCk').val();
      const emailVal = $('#email').val();
      const nickNameVal = $('#nickName').val();
      const phoneNumberVal = $('#phoneNumber').val();
      const birthdayVal = $('#birthday').val();

      if (userIdVal.trim()==='' ||
              userNameVal.trim()===''||
              passwordVal.trim()===''||
              passwordCkVal.trim()===''||
              emailVal.trim()===''||
              nickNameVal.trim()===''||
              passwordCkVal.trim()===''||
              birthdayVal.trim()===''
      ){
        alert("ë¹„ì–´ìˆëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!");
      }
      //ì•„ì´ë”” ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
      else if (idCk !== true){
        alert("ì˜¬ë°”ë¥¸ ì•„ì´ë””ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      //ì•„ì´ë”” ì¤‘ë³µì²´í¬ ì—¬ë¶€ í™•ì¸
      else if (idDuplicateCk !== true){
        alert("ì•„ì´ë”” ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
      }
      else if (userNameCk !== true){
        alert("ì˜¬ë°”ë¥¸ ì´ë¦„ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
      else if (passwordCk !== true){
        alert("ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      //ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ ì—¬ë¶€ í™•ì¸
      else if (passwordMatchCk !== true){
        alert("ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
      }
      else if (emailCk !== true){
        alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      else if (emailDuplicateCk!==true){
        alert("ì´ë©”ì¼ ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
      }
      else if (nicknameCk !== true){
        alert("ì˜¬ë°”ë¥¸ ë‹‰ë„¤ì„ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      else if (nicknameDuplicateCk !== true){
        alert("ë‹‰ë„¤ì„ ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
      }
      else if (phoneNumberCk !== true){
        alert("ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      }
      else if (birthdayCk !== true){
        alert("ì˜¬ë°”ë¥¸ ìƒë…„ì›”ì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
      } else {

        const formData = {
          userId: userIdVal,
          userName: userNameVal,
          password: passwordVal,
          passwordCk: passwordCkVal,
          email: emailVal,
          nickName: nickNameVal,
          phoneNumber : phoneNumberVal,
          birthday: birthdayVal
        };

        $.ajax({
          type : "POST",
          url : "/safe-ride/join",
          contentType: "application/json",
          data: JSON.stringify(formData),
          success : function (result){
            alert("íšŒì›ê°€ì…ë˜ì…¨ìŠµë‹ˆë‹¤!");
            window.location.href = "/safe-ride/login";
          },
          error:function (error){
            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." + error);
          }
        });
      }
    });
//  });


  //ì•„ì´ë”” ì •ê·œì‹
  function idValidCk() {
    //ì˜ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ì˜ë¬¸ì ë˜ëŠ” ìˆ«ì 6~20ì
    const regExp = /^[a-z]+[a-z0-9]{5,19}$/g;
    let userId = $('#userId').val(); // idê°’
    let idCkMsg = $('#idCkMsg');
    if (!regExp.test(userId)){
        idCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!(ì˜ë¬¸ìì‹œì‘ 6~20ì ì´ë‚´)");
        idCkMsg.css('color', "red");
        idCk = false;
    } else {
      idCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      idCkMsg.css('color', "blue");
      idCk = true;
    }
  }
  //ì´ë¦„ ì •ê·œì‹
  function userNameValidCk(){
    const regExp = /^[ê°€-í£]{2,10}$/;
    let userName = $('#userName').val();
    let userNameMsg = $('#userNameMsg');
    if (!regExp.test(userName)){
      userNameMsg.text("í•œê¸€ 2~10ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!");
      userNameMsg.css('color', "red");
      userNameCk = false;
    } else {
      userNameMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      userNameMsg.css('color', "blue");
      userNameCk = true;
    }
  }
  //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹
  function passwordValidCkFnc() {
    //ì˜ì–´ ìˆ«ì ì¡°í•© 8ìë¦¬ ì´ìƒ~25ì ì´í•˜
    const regExp = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,20}$/;
    let password = $('#password').val();
    let passwordCkMsg = $('#passwordCkMsg');
    if (!regExp.test(password)){
      passwordCkMsg.text("ì˜ì–´ ìˆ«ì ì¡°í•© 8~20ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!");
      passwordCkMsg.css('color', "red");
      passwordCk = false;
    } else {
      passwordCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      passwordCkMsg.css('color', "blue");
      passwordCk = true;
    }
  }

  //ì´ë©”ì¼ ì •ê·œì‹
  function emailValidCk() {
    //
    const regExp = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;
    let userId = $('#email').val(); // idê°’
    let emailCkMsg = $('#emailCkMsg');
    if (!regExp.test(userId)){
      emailCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!");
      emailCkMsg.css('color', "red");
      emailCk = false;
    } else {
      emailCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      emailCkMsg.css('color', "blue");
      emailCk = true;
    }
  }

  //ë‹‰ë„¤ì„ ì •ê·œì‹
  function nickNameValidFunc(){
    //ì˜ë¬¸ ëŒ€/ì†Œë¬¸ìë‚˜ í•œê¸€ë¡œ ì‹œì‘. ì˜ë¬¸ ëŒ€/ì†Œë¬¸ìì™€ í•œê¸€, ìˆ«ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°
    const regExp =/^[ã„±-ã…ê°€-í£a-zA-Z0-9]{2,10}$/;
    //2~10ì‚¬ì´ì˜ ê¸¸ì´

    let nickName = $('#nickName').val();
    let nickNameCkMsg = $('#nickNameCkMsg');
    if (!regExp.test(nickName)){
      nickNameCkMsg.text("2~10ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!(íŠ¹ìˆ˜ë¬¸ìë¶ˆê°€)");
      nickNameCkMsg.css('color', "red");
      nicknameCk = false;
    } else {
      nickNameCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      nickNameCkMsg.css('color', "blue");
      nicknameCk = true;
    }
  }

  //ì „í™”ë²ˆí˜¸ì •ê·œì‹
  function phoneNumberVaildFnc() {
    const regExp = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;

    let phoneNumber = $('#phoneNumber').val();
    let phoneNumberMsg = $('#phoneNumberMsg');

    if (!regExp.test(phoneNumber)){
      phoneNumberMsg.text("ì „í™”ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!");
      phoneNumberMsg.css('color', "red");
      phoneNumberCk = false;
    } else {
      phoneNumberMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      phoneNumberMsg.css('color', "blue");
      phoneNumberCk = true;
    }
  }
  //ìƒë…„ì›”ì¼ ì •ê·œì‹
  function birthdayVaildFnc() {
    const regExp = /^(19[0-9][0-9]|20\d{2})(0[0-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])$/;

    let birthday = $('#birthday').val();
    let birthdayMsg = $('#birthdayMsg');

    if (!regExp.test(birthday)){
      birthdayMsg.text("ìƒë…„ì›”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”!");
      birthdayMsg.css('color', "red");
      birthdayCk = false;
    } else {
      birthdayMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
      birthdayMsg.css('color', "blue");
      birthdayCk = true;
    }
  }


  //íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸
  function passwordMatchCkFnc() {
    //ë¹„ë°€ë²ˆí˜¸ ì²´í¬
    let password = document.querySelector("#password").value;
    let passwordCk = document.querySelector("#passwordCk").value;
    if (password !== passwordCk || password === '' || passwordCk === ''){
      alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
      passwordMatchCk = false;
    } else {
      alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•©ë‹ˆë‹¤! ^^");
      passwordMatchCk = true;
    }
  }

</script>
<!--ğŸ‘†ì—¬ê¸°ì— ì‚¬ìš©í•˜ëŠ” script ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
</body>
</html>