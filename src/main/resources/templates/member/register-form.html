<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <th:block th:replace="~{common/header :: headerFragment}"></th:block>
  <!--ğŸ‘‡ì—¬ê¸°ì— ê¸°íƒ€ header ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
  <style>
    .date_item{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      .warning{
        color:red;
        font-size:0.8rem;
        visibility:hidden;
        &.on{
          visibility:visible;
        }
      }
    }
  </style>
  <!--ğŸ‘† ì—¬ê¸°ì— ê¸°íƒ€ header ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ ğŸ‘†-->
</head>

<body>
<div class="wrapper">
  <th:block th:replace="~{common/sidebar :: sidebarFragment}"></th:block>

  <div class="main">
    <th:block th:replace="~{common/navbar :: navbarFragment}"></th:block>
    <main>
      <div class="container mt-4">
        <!--ğŸ‘‡ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
        <section class="py-5">
          <div class="container px-5">
            <!-- login form-->
            <div class="bg-light rounded-3 py-5 px-4 px-md-5 mb-5">
              <div class="row gx-5 justify-content-center">
                <div class="col-lg-8 col-xl-6">
                  <h1 class="text-center mb-5">íšŒì›ê°€ì…</h1>
                  <form action="/safe-ride/join" method="post" id="registerForm">
                    <div class="form-floating mb-3">
                      <input class="form-control" id="userId" name="userId" type="text" maxlength="30" required placeholder="ì•„ì´ë”” ì…ë ¥">
                      <button class="btn btn-danger btn" id="duplicateCkForId">ì•„ì´ë”” ì¤‘ë³µí™•ì¸</button>
                      <label for="userId">ì•„ì´ë””</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="userName" name="userName" type="text" maxlength="30" required placeholder="ì´ë¦„ ì…ë ¥">
                      <label for="userName">ì´ë¦„</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="password" name="password" type="password" maxlength="30" required placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                      <label for="password">íŒ¨ìŠ¤ì›Œë“œ</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="passwordCk" name="passwordCk" type="password" maxlength="30" required placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                      <label for="passwordCk">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="email" name="email" type="text" oninput="onInputEmail(this)" maxlength="30" required placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                      <label for="email">ì´ë©”ì¼</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="nickName" name="nickName" type="text" maxlength="30" required placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                      <label for="nickName">ë‹‰ë„¤ì„</label>
                    </div>
                    <div class="form-floating mb-3">
                      <input class="form-control" id="phoneNumber" name="phoneNumber" type="text" oninput="onInputPhone(this)" maxlength="13" required placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                      <label for="phoneNumber">ì „í™”ë²ˆí˜¸</label>
                    </div>
                    <div class="form-floating mb-3 date_item">
                      <input class="form-control" id="birthday" name="birthday" maxlength="10" required oninput="onInputBirth()"/>
                      <label for="birthday">ìƒë…„ì›”ì¼</label>
                      <span class="warning">ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œì…ë‹ˆë‹¤.</span>
                    </div>
                    <div class="d-grid"><button class="btn btn-primary btn-lg" id="sign-in-button" type="submit">Submit</button></div>
                    <div style="margin-top: 16px; text-align: right"><a href="/safe-ride/login">ë¡œê·¸ì¸</a></div>
                  </form>
                </div>
              </div>

            </div>
          </div>
        </section>
        <!--ğŸ‘†ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
      </div>
    </main>
    <th:block th:replace="~{common/footer :: footerFragment}"></th:block>
  </div>
</div>

<script src="js/app.js"></script>
<!--ğŸ‘‡ì—¬ê¸°ì— ì‚¬ìš©í•˜ëŠ” script ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
<script th:inline="javascript">
  window.onload = function () {
    //alert
    const alertMsg = [[${msg}]];

    if (alertMsg){
      alert(alertMsg);
    }
  }

  //submit ë²„íŠ¼ í´ë¦­
  let submitBtn = document.querySelector("#sign-in-button");

  submitBtn.addEventListener('click', function (event) {
    //ë¹„ë°€ë²ˆí˜¸ ì²´í¬
    let password = document.querySelector("#password").value;
    let passwordCk = document.querySelector("#passwordCk").value;
    if (password !== passwordCk){
      event.preventDefault();
      alert("íŒ¨ìŠ¤ì›Œë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”! ^^");
    }
  });

  //ì „í™”ë²ˆí˜¸ì •ê·œì‹
  function onInputPhone(target) {
    target.value = target.value
            .replace(/[^0-9]/g, '')
            .replace(/(^02.{0}|^01.{1}|[0-9]{3,4})([0-9]{3,4})([0-9]{4})/g, "$1-$2-$3");
  }
  //ìƒë…„ì›”ì¼ì •ê·œì‹
  let birthday = document.querySelector("#birthday");
  let warning = document.querySelector(".warning");

  const onInputBirth = () => {
    let val = birthday.value.replace(/\D/g, "");
    let leng = val.length;
    let result = '';

    if(leng < 6) result = val;
    else if(leng < 8){
      result += val.substring(0,4);
      result += "-";
      result += val.substring(4);
    } else{
      result += val.substring(0,4);
      result += "-";
      result += val.substring(4,6);
      result += "-";
      result += val.substring(6);

      if(!checkValidDate(result)){
        warning.classList.add("on");
      } else{
        warning.classList.remove("on");
      }
    }
    birthday.value = result;
  }


  const checkValidDate = (value) => {
    let result = true;
    try {
      let date = value.split("-");
      let y = parseInt(date[0], 10),
              m = parseInt(date[1], 10),
              d = parseInt(date[2], 10);

      let dateRegex = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;
      result = dateRegex.test(d+'-'+m+'-'+y);
    } catch (err) {
      result = false;
    }
    return result;
  }


</script>
<!--ğŸ‘†ì—¬ê¸°ì— ì‚¬ìš©í•˜ëŠ” script ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
</body>
</html>